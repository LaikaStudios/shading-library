##
##  Copyright(c) 2010 Laika, developed under contract by mitchpraterLLC.
##  All rights reserved unless otherwise granted. This program or documentation
##  contains proprietary, confidential information and trade secrets of Laika
##  and/or mitchpraterLLC. Use of copyright notice does not imply publication.
##  
##  By possessing this software, you agree to the following terms and conditions.
##  You may not resell this software, but you may freely distribute it to others.
##  You may use it for whatever purposes you wish. There are no warranties of any
##  kind. You may make modifications, however any derivation may only be distributed
##  to others under the same freedoms granted to you herein, it must retain this
##  notice and agreement, and the modifications noted. We also ask that you make
##  such modifications available to Laika, mitchpraterLLC, or to the computer
##  graphics community as a whole through a public forum.
##
slim 1 extensions mprater {
  extensions laika vfx {

    templateV FractalizerManifold_s FractalizerManifold 0 {
        description {
            Returns the point currently being sampled by the Fractalizer template.
            Connect this template to both the Fractalizer and the Base Pattern generation
            network you're Fractalizing. Otherwise, you'll just get a single Layer.
        }

        parameter manifold_s in {
            label {Source Manifold}
            description {
                This is whatever Manifold you want to be used for your Base Pattern generation.
            }
            detail mustvary "laika,UV"
        }

        parameter FractalizerManifold_s out {
            display hidden
            access output
        }


        RSLInclude {mapper/FractalizerManifold.h}

		RSLFunction {
		    void vfxFractalizerManifold (
                output manifold_s  in;
                output FractalizerManifold_s    out;
            ) {
                out->Set (in->GetQ(), in->GetdQu(), in->GetdQv());
            }
		}
	}

    template visualizer FractalizerManifold_s {
        parameter FractalizerManifold_s vis {}

        RSLInclude {sl.h}
        RSLInclude {mapper/FractalizerManifold.h}

        RSLMain {
            generate
            output "
                Ci = _mod (color (point [getvar vis]->GetQ()), 1);
                Oi = color 1;
            "
        }
    }

  }
}
